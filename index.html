<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="AST-based advanced mathematical parser written by Typescript..">
    <meta property="og:url" content="http://www.pigno.se/barn/PIGNOSE-FormulaParser">
    <meta property="og:type" content="product"/>
    <meta property="og:title" content="PIGNOSE FormulaParser"/>
    <meta property="og:description" content="AST-based advanced mathematical parser written by Typescript.">
    <meta property="og:image" content="http://www.pigno.se/barn/PIGNOSE-FormulaParser/demo/img/cover@250.png">
    <meta property="og:site_name" content="PIGNOSE"/>
    <title>Metric Parser</title>
    <link rel="shortcut icon" type="image/x-icon" href="demo/img/pignose-ico.ico">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css">
    <link rel="stylesheet" type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.13.0/themes/prism.min.css">
    <link rel="stylesheet" type="text/css" href="demo/css/style.css">
</head>

<body>
<div id="wrapper">
    <div class="header">
        <h1>Metric Parser</h1>
        <a href="https://github.com/KennethanCeyer/metric-parser" target="_blank" class="ui button black">View project
            on Github</a>
        <a href="https://github.com/KennethanCeyer/metric-parser/archive/master.zip" target="_blank"
           class="ui button blue">Download zip</a>
        <a href="docs/index.html" target="_blank" class="ui button teal">Reference docs</a>
        <h4 class="version">Latest version <strong></strong></h4>
    </div>
    <div class="article formula-parsing">
        <h3>
            <span>Formula Parsing</span>
        </h3>

        <div class="formula-expression formula-expression-01"></div>
        <div class="formula-expression formula-expression-02"></div>
        <div class="formula-expression formula-expression-03"></div>
        <div class="formula-expression formula-expression-04"></div>
        <div class="formula-expression formula-expression-05"></div>
        <div class="formula-expression formula-expression-06"></div>
    </div>


    <div class="article">
        <h3>
            <span>Formula Unparsing</span>
        </h3>

        <div class="formula-expression formula-expression-07"></div>
        <div class="formula-expression formula-expression-08"></div>
        <div class="formula-expression formula-expression-09"></div>
        <div class="formula-expression formula-expression-10"></div>
    </div>

    <div class="article">
        <h3>
            <span>Validation</span>
        </h3>

        <div class="formula-expression formula-expression-11"></div>
        <div class="formula-expression formula-expression-12"></div>
        <div class="formula-expression formula-expression-13"></div>
        <div class="formula-expression formula-expression-14"></div>
        <div class="formula-expression formula-expression-15"></div>
    </div>
</div>
<div id="bower" class="article">
    <h3><span>bower</span></h3>
    <blockquote><p>If you use bower.</p></blockquote>
    <pre><code class="language-bash">$ bower install metric-parser</code></pre>
</div>
<div id="npm" class="article">
    <h3><span>npm</span></h3>
    <blockquote><p>If you use npm.</p></blockquote>
    <pre><code class="language-bash">$ npm install metric-parser</code></pre>
</div>
<div id="yarn" class="article">
    <h3><span>yarn</span></h3>
    <blockquote><p>If you use yarn.</p></blockquote>
    <pre><code class="language-bash">$ yarn add metric-parser</code></pre>
</div>
<div id="sample" class="article">
    <h3><span>Example</span></h3>
    <br/>
    <ul class="ui top pointing secondary menu">
        <a role="presentation" class="item active" data-tab="web">Web</a>
        <a role="presentation" class="item" data-tab="nodejs">NodeJS</a>
        <a role="presentation" class="item" data-tab="typescript">Typescript</a>
    </ul>
    <div role="tabpanel" class="ui tab segment active" data-tab="web">
        <pre><code class="language-javascript">// parse
const parseResult = metricParser.convert({expression});

// unparse
const unparseResult = metricParser.convert(parseResult);

// validation
const result = metricParser.convert({expression | parseTree});
const isValid = result.code === 0;

// validation only
const isValid2 = metricParser.valid({expression | parseTree});
</code></pre>
    </div>
    <div role="tabpanel" class="ui tab segment" data-tab="nodejs">
        <pre><code class="language-javascript">const parser = require('metric-parser');

// parse
const parseResult = parser.convert({expression});

// unparse
const unparseResult = parser.convert(parseResult);

// validation
const result = parser.convert({expression | parseTree});
const isValid = result.code === 0;

// validation only
const isValid2 = parser.valid({expression | parseTree});
</code></pre>
    </div>
    <div role="tabpanel" class="ui tab segment" data-tab="typescript">
        <pre><code class="language-typescript">import { convert, valid } from 'metric-parser';

// parse
const parseResult: ParserGeneralResult = convert({expression});

// unparse
const unparseResult: ParserGeneralResult = convert(parseResult);

// validation
const result = convert({expression | parseTree});
const isValid = result.code === 0;

// validation only
const isValid2: boolean = valid({expression | parseTree});
</code></pre>
    </div>
</div>
<script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>
<script type="text/javascript" src="dist/metric.parser.umd.js"></script>
<script>
    var expressions = [
        '12 + 3',
        '6 - 2 * 4',
        '6 - 2 * 4 / ( 2 - 4 )',
        '6 + 2 * (3 + (4 / 2) * 4 * (2 + (4 + 2 * 6)) * 2)',
        '6 + 4 ^ 2 ^ (4 + 2) / 5',
        '((((1) + (2)) + (3)) + (4))',
        {
            operator: '+',
            operand1: {
                value: {
                    type: 'unit',
                    unit: 12
                }
            },
            operand2: {
                value: {
                    type: 'unit',
                    unit: 1
                }
            }
        },
        {
            operator: '-',
            operand1: {
                value: {
                    type: 'unit',
                    unit: 6
                }
            },
            operand2: {
                operator: '*',
                operand1: {
                    value: {
                        type: 'unit',
                        unit: 2
                    }
                },
                operand2: {
                    value: {
                        type: 'unit',
                        unit: 4
                    }
                }
            }
        },
        {
            operator: '+',
            operand1: {
                operator: '+',
                operand1: {
                    value: {
                        type: 'unit',
                        unit: 12
                    }
                },
                operand2: {
                    value: {
                        type: 'unit',
                        unit: 3
                    }
                }
            },
            operand2: {
                operator: '/',
                operand1: {
                    operator: '+',
                    operand1: {
                        operator: '*',
                        operand1: {
                            value: {
                                type: 'unit',
                                unit: 2
                            }
                        },
                        operand2: {
                            value: {
                                type: 'unit',
                                unit: 4
                            }
                        }
                    },
                    operand2: {
                        value: {
                            type: 'unit',
                            unit: 5
                        }
                    }
                },
                operand2: {
                    value: {
                        type: 'unit',
                        unit: 2
                    }
                }
            }
        },
        {
            operator: '*',
            operand1: {
                operator: '/',
                operand1: {
                    value: {
                        type: 'item',
                        item: {
                            table: 'table-01',
                            key: 'col-02',
                            name: 'Item1',
                            oper: 'sum'
                        }
                    }
                },
                operand2: {
                    value: {
                        type: 'item',
                        item: {
                            table: 'table-02',
                            key: 'col-04',
                            name: 'Item2',
                            oper: 'sum'
                        }
                    }
                }
            },
            operand2: {
                value: {
                    type: 'unit',
                    unit: 100
                }
            }
        },
        '(1 + 2) 3',
        '((1 + 2',
        '2 + 3))',
        '1 ! 2',
        '1 ++ 4'
    ];

    function getTextHtml(text) {
        return text.split('').map(function(char) {
           return '<span class="formula-expression-char">' + char + '</span>';
        });
    }

    function getJsonHtml(data) {
        if (typeof data !== 'object')
            return getTextHtml(data);

        var json = JSON.stringify(data, null, '/%t/').replace(/\n/g, "/%b/");
        return Prism.highlight(json, Prism.languages.json)
            .replace(/\/%b\//mg, '<br />')
            .replace(/\/%t\//mg, '&nbsp;&nbsp;&nbsp;&nbsp;');
    }

    function showStack($expression, result) {
        if (!result.code || !result.stack)
            return;

        var className = '.formula-expression-char';
        var $stackTarget = $expression.find(className).eq(result.stack.col);

        var $cursor = $('<span class="formula-expression-bar"></span>');

        if ($stackTarget.length)
            $cursor.insertBefore($stackTarget);
        else
            $cursor.appendTo($expression);
    }

    $(function () {
        $('.version strong').text(metricParser.getVersion());
        $('.formula-expression').each(function (index) {
            var $this = $(this);
            var expression = expressions[index];

            if (!expression)
                return;

            var $formulaDisplay = $('<div class="formula-display"></div>');
            var $formulaResult = $('<div class="formula-result"></div>');

            var result = metricParser.convert(expression);

            $this.html(getJsonHtml(expression));
            $formulaDisplay.html(getJsonHtml(result));
            $formulaDisplay.insertAfter($this);
            $formulaResult.clone().appendTo($this).text('Expression');

            var $target = $formulaResult.clone().appendTo($formulaDisplay);
            $target.append('<span>Result</span><span class="formula-status"></span>');
            $formulaDisplay.addClass(result.code ? 'formula-display-error' : 'formula-display-success');

            showStack($this, result);
        });

        $('.menu .item').tab();
    });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.13.0/prism.min.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.13.0/components/prism-javascript.min.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.13.0/components/prism-typescript.min.js"></script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.13.0/components/prism-json.min.js"></script>
</body>
</html>
